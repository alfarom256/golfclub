; ┌──────────────────────────────────────────────────────────────────────────┐ @@&#@@@@@@@@@@@@@@@@@
; │ BGGP2021: PE/PDF/JS Polyglot alert(2) - 487 byte - @netspooky - 20210916 │ #(&@@@@@@@@@@@@@@@@@@
; │ SHA256: 55f8e1e8ebaf5f49016d74a154b18c475039d148076ad2aceec9622d1139da2b │ &@@@@@@@@@@@@@@@@@@@@
; └──────────────────────────────────────────────────────────────────────────┘ @@@@@@@@@@@@@@@@@@@@@
; 00000000: 4d5a 3d22 5045 0000 4c01 0000 2550 4446  MZ="PE..L...%PDF @@@#/#@@@@@@@@@@@@@@@@@@@@@@@@
; 00000010: 2d31 2e22 3b2f 2a20 6000 0301 0b01 0000  -1.";/* `....... @&(*%@@@@@@@@@@@@@@@@@@@@@@@@@
; 00000020: 0a31 2030 206f 626a 3c3c 2500 5701 0000  .1 0 obj<<%.W... &(/%@@@@@@@@@@@@@@@@@@@@@@@@@@
; 00000030: 0a2f 5061 6765 7325 0000 4000 0400 0000  ./Pages%..@..... #/#&@@@@@@@@@@@@@@@@@@@@@@@@@@
; 00000040: 0400 0000 0a32 2030 2052 2500 0500 0000  .....2 0 R%..... /(&@@@@@@@@@@@@@@@@@@@@@@@@@@@
; 00000050: ffff ffff 0080 0000 7c00 0000 0000 0000  ........|....... (%@@@@@@@@@@@@@@@@@@@@@@@@@@@@
; 00000060: 0200 0004 0000 1000 0010 0000 0000 1000  ................ %@@@@@@@@@@@@@@@@@@@@@@@@@@@@@
; 00000070: 0a2f 4e61 6d65 7325 0000 0000 0a34 2030  ./Names%.....4 0 @@@@@@@@@@@@@@@@@@@@@@@@@@@@@@
; 00000080: 2052 3e3e 656e 646f 626a 2032 2030 206f   R>>endobj 2 0 o @@@@@@@@@@@@@@@@@@@@@@@@@@@@@@
; 00000090: 626a 3c3c 2f4b 6964 735b 3320 3020 525d  bj<</Kids[3 0 R] @@@@@@@@@@@@@@@@@@@@@@@@@@@@@@
; 000000a0: 2f43 6f75 6e74 2031 3e3e 656e 646f 626a  /Count 1>>endobj @@@@@@@@@@@@@@@@@@@@@@@@@@@@@@
; 000000b0: 2033 2030 206f 626a 3c3c 2f4d 6564 6961   3 0 obj<</Media @@@@@@@@@@@@@@@@@@@@@@@@@@@@@@
; 000000c0: 426f 783e 3e65 6e64 6f62 6a20 3420 3020  Box>>endobj 4 0  @@@@@@@@@@@%####@@@@@@@@@@@@@@
; 000000d0: 6f62 6a3c 3c2f 4a61 7661 5363 7269 7074  obj<</JavaScript @@@@@@%%#########@@@@@@@@@@@@@
; 000000e0: 2035 2030 2052 3e3e 656e 646f 626a 2035   5 0 R>>endobj 5 @&%####(///(######&@@@@@@@@@@@
; 000000f0: 2030 206f 626a 3c3c 2f4e 616d 6573 5b28   0 obj<</Names[( (/**/%&@@@(*(######&@@@@@@@@@@
; 00000100: 6229 3620 3020 525d 3e3e 656e 646f 626a  b)6 0 R]>>endobj @@@@@@@@@@&*/#######%@@@@@@@@@
; 00000110: 2036 2030 206f 626a 3c3c 2f4a 5328 6170   6 0 obj<</JS(ap @@@@@@@@@@@%*(########@@@@@@@@
; 00000120: 702e 616c 6572 7428 3229 292f 532f 4a61  p.alert(2))/S/Ja @@@@@@@@@@@@/*#########&@@@@@@
; 00000130: 7661 5363 7269 7074 3e3e 656e 646f 626a  vaScript>>endobj @@@@@@@@@@@@#,##########%@@@@@
; 00000140: 0a74 7261 696c 6572 3c3c 2f52 6f6f 7420  .trailer<</Root  @@@@@@@@@@@@@*(##########%@@@@
; 00000150: 3120 3020 523e 3e31 c9f7 e164 8b41 308b  1 0 R>>1...d.A0. @@@@@@@@@@@@@(.##########%@@@@
; 00000160: 400c 8b70 14ad 96ad 8b58 108b 7b3c 01df  @..p.....X..{<.. @@@@@@@@@@@@@%.########&@@@@@@
; 00000170: 8b7f 7801 df8b 7720 01de 41ad 01d8 6681  ..x...w ..A...f. @@@@@@@@&#/***######%@@@@@@@@@
; 00000180: 7806 6341 75f4 8b77 2401 de66 8b0c 4e49  x.cAu..w$..f..NI @@@&#/*,*/(########%&&@@@@@@@@
; 00000190: 8b77 1c01 de8b 3c8e 01df 5268 6172 7941  .w....<...RharyA /************(((((#########%&&
; 000001a0: 684c 6962 7268 4c6f 6164 5453 ffd7 686c  hLibrhLoadTS..hl %%%%%%%%%%%(//////////////////
; 000001b0: 6c00 0068 3332 2e64 6855 7365 7254 ffd0  l..h32.dhUserT.. @@@@@@@@@@@@@@@@@@@@@@@@@@@@@@
; 000001c0: 686f 7841 0068 6167 6542 684d 6573 7354  hoxA.hageBhMessT %@@@@@@@@@@@@@@@@@@@@@@@@@@@@@
; 000001d0: 50ff d76a 3289 e152 5151 52ff d02a 2f61  P..j2..RQQR..*/a ,&@@@@@@@@@@@@@@@@@@@@@@@@@@@@
; 000001e0: 6c65 7274 2832 29                        lert(2) @@@@@@@@&(*&@@@@@@@@@@@@@@@@@@@@@@@@@@@
BITS 32 ;@@#**/(######/(@@@@@@@@@@@@@@@@@@@@@@&/*%@@@@@@@@@@@@@@@@@&(*,*(@@@@@@@@@@@@@@@@@@@@@@@@@@@
mzhdr: ; MZ Header ──────────┬──────────────────────────────────────────────────────────────────────
  dw "MZ"             ; 0x00 │ [MA] e_magic @@@@@@@@@@@@@%(,*(%@@&&#######/#@@@@@@@**%**#@@@@@@@@@@@
  dw 0x223d           ; 0x02 │ [MB] e_cblp  ~ Bypass TinyPE detections ~ &&%##&@@@@@@(*#&#//%@@@@@@@
pehdr: ; PE Header ──────────┼──────────────────────────────────────────────────────────────────────
  dd "PE"             ; 0x04 │ [MC] e_cp [MD] e_crlc [PA] PE Signature &@@@@@@@@@@@@@.*///(%@@&#(*/%
  dw 0x014C           ; 0x08 │ [ME] e_cparhdr [PB] Machine (Intel 386) .....*#&@@@@@@.*////,&./(%&@&
  dw 0                ; 0x0A │ [MF] e_minalloc [PC] NumberOfSections .............,,/#*///,,,****/(#
  db "%PDF-1."        ; 0x0C │ [MG] e_maxalloc [MH] e_ss [PD] TimeDateStamp ..............,.(.///*/*
                      ; 0x10 │ [MI] e_sp [MJ] e_csum [PE] PointerToSymbolTable ...................,,
  dd 0x2a2f3b22       ; 0x13 │ [MK] e_ip [ML] e_cs [PF] NumberOfSymbols ............................
  db 0x20             ; 0x17 │ FREE SPACE, 0x18 can be less than 0x60! :eyes: ......................
  dw 0x60             ; 0x18 │ [MM] e_lsarlc [PG] SizeOfOptionalHeader ...*.........................
  dw 0x103            ; 0x1A │ [MN] e_ovno [PH] Characteristics ............*(/.....................
ophdr: ; Optional Header ────┼──────────────────────────────────────────────────────────────────────
  dw 0x10B            ; 0x1C │ [MO] e_res [OA] Magic (PE32) .....................,#%*...............
  dw 0                ; 0x1E │ [MO] e_res [OB] MajorLinkerVers [OC] MinorLinkerVers *@(.............
  db 10, "1 0 obj<<%" ; 0x20 │ [MO] e_res [OD] SizeOfCode **..........................,%#,..........
                      ; 0x24 │ [MP] e_oemid [MQ] e_oeminfo [OE] SizeOfInitializedData ..,(*.........
                      ; 0x28 │ [MR] e_res2 [OF] SizeOfUninitializedData ..................**........
  db 0                ; 0x2B │ FREE SPACE @@@@&/***************............................,#(,.....
  dd _start - $$      ; 0x2C │ [MR] e_res2 [OG] AddressOfEntryPoint ........................*&@@@@@%
  db 10, "/Pages%"    ; 0x30 │ [MR] e_res2 [OH] BaseOfCode ******,.........................../@@@@@@
                      ; 0x34 │ [MR] e_res2 [OI] BaseOfData *******,...........................%@@@@@
  dd 0x400000         ; 0x38 │ [MR] e_res2 [OJ] ImageBase *********,........................../&&%%#
  dd 4                ; 0x3C │ [MS] e_lfanew [OK] SectionAlignment ,*(#%&&%#(*,...............,#####
  dd 4                ; 0x40 │ [OL] FileAlignment (#&&&%#/,..**,#@@@@@@@@@@@@@@@&/............./####
  db 10, "2 0 R%"     ; 0x44 │ [OM] MajorOSVers [ON] MinorOSVers @@@@@@@@@@@@@@@@@@%,..........,####
                      ; 0x48 │ [OO] MajorImageVers [OP] MinorImageVers @@@@@@@@@@@@@@&**(%%/**.,####
  db 0                ; 0x4B │ FREE SPACE @@@@@@@@@@@&&@@@@#/@@@@@@@@@@@@@@@@@@@@@@@@@@%/%&/@@#,//**
  dd 5                ; 0x4C │ [OQ] MajorSubsysVers [OR] MinorSubsysVers @@@@@@@@@@@@@@@&(#/@@@%*(&&
  dd 0xFFFFFFFF       ; 0x50 │ [OS] Win32VersionValue - FREE SPACE &&@@@@@@@@@@@@@@@@@@@@%(&@@@@&*/&
  dd 0x8000           ; 0x54 │ [OT] SizeOfImage &&&&&&&&@@%/&&&&&&&&&&&&@@@@@@@@@@@@@@@##@@@@@@@@&((
  dd 0x7C             ; 0x58 │ [OU] SizeOfHeaders &&&&&&&@%/&&&&&&&&&&&&&&&@@@@@@@@@%/&@@@@@@@@@@@&/
  dd 0                ; 0x5C │ [OV] CheckSum &&&&&&&&&&&&@%/&&&&&&&&&&&&&&&&&@@@@@##@@@@@@@@@@@@@@@%
  dw 2                ; 0x60 │ [OW] Subsystem (Win32 GUI) %/&&&&&&&&&&&&&&&&&@@%(%@&&&&&&@@@@@@@@@@@
  dw 0x400            ; 0x62 │ [OX] DllCharacteristics &&&%/#&&&&&&&&&&&&&&@@#/#&&&&&&&&&&&&@@@@@@@@
  dd 0x100000         ; 0x64 │ [OY] SizeOfStackReserve &&&%//#&&&&&&&&&&&&@&/##%&&&&&&&&&&&@@@@%#/,*
  dd 0x1000           ; 0x68 │ [OZ] SizeOfStackCommit &&&%#(*#%&&&&&&&&&&@%/##(/,,,*((((((/.../#####
  dd 0x100000         ; 0x6C │ [O1] SizeOfHeapReserve &&%##//(#%&&&&&&&&&(,,,*********/((######(/(##
  db 10, "/Names%"    ; 0x70 │ [O2] SizeOfHeapCommit &&&%#((#/##%%%%@&/..,***************/######%&//
                      ; 0x74 │ [O3] LoaderFlags /,.*/#%##((###/##&@#....,******************(#####%&(
  dd 0                ; 0x78 │ [O4] NumberOfRvaAndSizes ......,(&(,.....,******************/######%@
;────────────────────────────┴──────────────────────────────────────────────────────────────────────
  db 10, "4 0 R>>endobj";*************************,....*(,...,............,******************(####%@
  db " 2 0 obj<</Kids[3 0 R]/Count 1>>endobj";..........,(*..................*****************(###&@
  db " 3 0 obj<</MediaBox>>endobj";*......................,......................,************/#%&//
  db " 4 0 obj<</JavaScript 5 0 R>>endobj";..........................................***********,(##
  db " 5 0 obj<</Names[(b)6 0 R]>>endobj";...............................................,***./#####
  db " 6 0 obj<</JS(app.alert(2))/S/JavaScript>>endobj";*/*................................*(####(((
  db 10, "trailer<</Root 1 0 R>>";...............,,,,.*/////,.,,,........................,(((///////
_start: ;//**********&%///////****,..........,,,,,,,,,///////*.,,,,,,,.................,////////////
  xor ecx, ecx ;..%@@%///////////****.....,***,......//////////*%&&&&&&%#(/............/////////////
  mul ecx ;///*#&@&##/*///////////*****,.,/(%%&&&&%,*///////////*#&&&&&&&&&&&&&&%#(*../************/
  mov eax, [fs:ecx+0x30] ;/////////,*(##%&&&&&&&&&#./////////////*#&&&&&&&&&&&&&&&&&&&%(*,********/(
  mov eax, [eax+0xc] ;**///////**#&&&%%%%&&&&&&&&&,*//////////////*%&&&&&&&&&&&&&&&&&&&&&&&#/,/#&@@@
  mov esi, [eax+0x14] ;****/*/@@@&&&%%%%&&&&&&&&&&,////////////////*%&&&&&&&&&&&&&&&&&&&&&&&&&&#*/##
  lodsd ;&&#############(*.*&&&@@&&%%%%%&&&&&&&&&&,////////////////**&&&&&&&&&&&&&&&&&&&&&&&&&&&@@/*
  xchg eax, esi ;@@@@@@@(/%&&&&@@&&&%%%%%&&&&&&&&&,/////////////////*/&&&&&&&&&&&&&&&&&&&&&&&&&@@@%%
  lodsd ;#%%@&&@@%&&%%&//%&&&&&&@@&&&%%%%&&&&&&&&&,//////////////////.#&&&&&&&&&&&&&&&&&&&&&&&@@@&%%
  mov ebx, [eax+0x10] ;*/&&&&&&&&@@&&&%%%%&&&&&&&&,//////////////////*,&&&&&&&&&&&&&&&&&&&&&&@@@%%%%
  mov edi, [ebx+0x3c] ;/*#&&&&&&&@@@&&&&%%%&&&&&&&*******,,,,,**/(#%%&&&&&&&&&&&&&&&&&&&&&&&@@@%%%%&
  add edi, ebx ;/////////,#&&&&&&&&@@&&&&&&&%%%&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&@@&%%%%%%&&
  mov edi, [edi+0x78] ;*///.#&&&&&&&&&&&&&&&&&&&%%%%%&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&%%%%&
  add edi, ebx ;/////****////**#&&&&&&@@@&&&&&%#////////(%%&&&&&&&&&&&&&&&&&&%#////((%&&&@@@@@@&%%%&
  mov esi, [edi+0x20] ;#**/////***%&&@@@@&&(**/(########(///#%&&&&&&&&&&&&#(*/(%%%%%#(//#&@@@@@%%%%&
  add esi, ebx ;//////**%%**////**,.#&&%#/*/#%&&&&&&&&&&%%#/*(%&&&&&&&&&%//(%&&&&&&&&&&%(/(%%%%%%%&&
getGetProcAddress: ;///,*%&&#*,*/%&%,&&#*(#%%#(******/#%&&%#*/#%&&&&&&&%//#&&&&&%###&&&&%(*#%%%&&&&&
  inc ecx ;/////////,////,#&&&%%(*,.*&&#(#%%/*/#&&&&&(*(%&%#*/#%&&&&&&&#*/%&&&*/##(/*%&&%(*#%%%%&&&&
  lodsd ;/////////,.///////,(%&&&&/*%#&%%&%**#%%#/(##//#%&%#*/#%&&&&&&%(*/%&&&(/#(/(#%%#(/(#%%%%&&&&
  add eax, ebx ;/,#./////////****,/#,#&&&&%/*#%&&%%%%%%&&%#/*#%&&&&&&&%#//#&&&#(//(((/**/#%%%%%%&&&&
  cmp word [eax+0x6], 0x4163 ;/#*(%*.%&&&&&%/(##%&&&&&&%#(//%&&&&%#&&&%%(//#%&&&%%%%%%%%&%((#%%%&&&&
  jnz getGetProcAddress ;////*,,(&/*,#&&&&&&&#/*/((((((**(%&&&&#*#&&&&&%%%#/**(#%&&&&##(*(#%%%%&&%#/
  mov esi, [edi+0x24] ;**///**,#&#,##,%%%%%%%%%%########%&&&&&/*#%%%%%%%%%%%##((*****((##%%#(/.,,/&&
  add esi, ebx ;%###/,/*.///,*%&&*/&#/*(/*/#%%%%%%%%%%%%%%&&%/,/%%%%%%%%%%%%%###(*,,,**/((##**.#&&&%
  mov cx, [esi+ecx*2] ;,**/.(%&&&*(&##*/&&%%(**/#%%%%%###%&#,**#%%%%%#(****/(##%%&&&&&&%/*/**%&&#*/(
  dec ecx ;*/&&&%#####(,//./&&&&&*(&%#(*(&&&&&&%#*/#%%%%((#,#.#%%#(,/#%&&&&&&&&&&&&%(**(#//%&(*/%&&&
  mov esi, [edi+0x1c] ;((%(.(&&&&*(&&##(*(&&&&&&&&%#,(#%%/,/&.##*./%&&&&&&&&&&&&&#*/###(*%#,#&&&&&&&
  add esi, ebx ;&%######/%&%*/%&&*(&&%###/*&&&&&&&&&&#(#%*/%&.(/*/%&&&&&&&&&&&%(/####/,/*(/(////////
  mov edi, [esi+ecx*4] ;#/#&&#*(&/*&&&%####*/%%&&&&&&&%%&/(&&*/(*#&&&&&&&&&&&(#%%%%(,*(&@@@@@@@&%###
  add edi, ebx ;&&&&%#####/(&&%//#,(&&&%#####/*(%%%%%%&&&/(&&#***%&&&&&@@@&&@@@@@&/(&@@@@@@@@@@@@@@@
  push edx ;*///////(######(/%&&%//.#&&&%#######**/(#%%%%*/%&&#**%&@@@@@@@@@@@@@%(&@@@@@@@@@@@@@@@@@
  push 0x41797261 ;(((((/////(#%%&&(,(&&&&&&&&&&&&&%(*,/((,(&@@@##@@@@@@@@@@@@@#(@@@@@@@@@@@@@@@@@@@
  push 0x7262694c ;@@@@@@@@@@&%(//(#&%/%&&@@&&&&&&&&&&&&&%(*&@@@@@@&&@@@@@@@@(/&@@@@@@@@@@@@@@@@@@@#
  push 0x64616f4c ;@@@@@@@@@@@@@@@@@%#(/(&@@@@@@@@@@@@@@@@@%/&@@@@@@@@&&&&#/#&&&&&&&&@@@@@@@@@@@@##&
  push esp ;@@@@@@@@@@@@@@@@@@@@@@@@@@@@&(#&@@@@@@@@@@@@@@@@@%#&&&&&&&&%##%&&&&&&&&&&&&&&&&&&@%(%@@@
  push ebx ;@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@#(#&@@@@@@@@@@@@&&&&%%&&&%%&&&&&&&&&&&&&&&&&&&%%(((&&@@@@
  call edi ; GetProcAddress("kernel32.dll", "LoadLibraryA") &&&&&&&&&&&&&&&&&&&&&&&&%%#//#%&&&&&&&@@
  push 0x6c6c ;@@@&&#**&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&%##/#%&&&&&&&&&&&&&&&&
  push 0x642e3233 ;@&&&%*(&&&&&&&&&&&&&&&&&&&&&&&&&&& [ BUILD ] &&&&&&&&&&&&&&&&&&&&&&&&&%%#########
  push 0x72657355 ;&&&&&%,%&&&&&&&&&&%&&&&&&&&&&&&&&& $ nasm -f bin ns.bggp2021.asm -o alert2.exe ##
  push esp ;@@&&&&%,(&&&#*%&&&&&%%(#&&&&&&&&&&&&&&&&& $ cp alert2.exe alert2.pdf &&&&&%,(###########
  call eax ; LoadLibraryA("User32.dll") &&&&&&&&&&&&& $ cp alert2.exe alert2.js &&&&&&&(,(##########
  push 0x41786f ;&&&&(,/##&&&&&&&&&&&&&&&&&&&&&&&&&&& [ RUN ] &%##############%&&&&&&&&&#*(#########
  push 0x42656761 ;&&&(/%&&&&&&&&&&&&&&&&&&&&&&&&&&&& C:> alert2.exe ##########%&&&&&&&&&#,/########
  push 0x7373654d ;&&&(/%&&%#(/////((#######%%%&&&&&& C:\> firefox alert2.pdf #%&&&&&&&&%*.,.,(#####
  push esp ;&&&&&&&&&%/*(/(###########%%&&&&&&&&&&&&& HTML: <script src="./alert2.js"> %/.,,,,,,*/(#
  push eax ;&&&&&&&&&(*##########%&&&&&&&&&&&&&&&&&&&&&&&&&################//%&&&&&&&&#*/(*******,.,
  call edi ; GetProcAddress("User32.dll","MessageBoxA") &%##############(/(%&&&&&&&&(.&@@@%/*****,.,
  push '2' ;%%%&&%,*########%&&&&&&&&&&%(/(%&&&&&&&&&&################//#&&&&&%#/*.,,.(&@@@&/****,,*
  mov ecx, esp ;*/*######%&&&&&&&&&&&(*#%&&&&&&&&%%##############(***(#((/*,,..,,,,,,.*,*%&%/,.**//*
  push edx ;/#%%(,#####%&&&&&&&%%(*./%&&&&&%%#(/////////////**,......,,,,,****.,,,,.,**,,***////////
  push ecx ;&&%(/###%&&&&&%%(/**/*#&&%#/,,*/////((//..,,,,,,,,,,,,,,,,,,,*****.,,,.****,///////////(
  push ecx ;%**#%&&&&&%(/,*(##(*##/.*(((((((###(*.,,,,,,,,,,,,,,,,,,,,,,,****.,,,,****,,/////////(##
  push edx ;.,,,,,*//########(*/*(###########/,,,,,,,,,,,,,,,,,,,,,,,,,,*****,.,*****,.///////(#####
  call eax ; MessageBoxA(0,"2","2",0) #######.,,,,,,,,,,,,,,,,,,,,,,,,,*************.*//(###########
  db "*/" ;//#%%#############################(,,..,,,,,,,,,,,,,,,,,,,**************./##############(
  db "alert(2)" ;,*/(########################////////*,,,,,,,,,,,,***************,,/#############(,#
